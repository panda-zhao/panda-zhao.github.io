<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../js/jquery.min.js"></script>
  <title>经营范围</title>
</head>
<body>
  
  <script>
    let json = [{"license_type":"0","bultem_code":"A01","select_type":"1","bultem_name":"农、林、牧、渔业","children":[{"b_stop":"0","license_type":"0","bultem_code":"A01001","select_type":"1","bultem_name":"农业"},{"b_stop":"0","license_type":"0","bultem_code":"A01002","select_type":"1","bultem_name":"林业"},{"b_stop":"0","license_type":"0","bultem_code":"A01003","select_type":"1","bultem_name":"畜牧业"},{"b_stop":"0","license_type":"0","bultem_code":"A01004","select_type":"1","bultem_name":"渔业"},{"b_stop":"0","license_type":"0","bultem_code":"A01005","select_type":"1","bultem_name":"农、林、牧、渔服务业"}]},{"license_type":"0","bultem_code":"B01","select_type":"1","bultem_name":"采矿业","children":[{"b_stop":"0","license_type":"1","bultem_code":"B01006","select_type":"1","bultem_name":"煤炭开采和洗选业"},{"b_stop":"0","license_type":"0","bultem_code":"B01007","select_type":"1","bultem_name":"石油和天然气开采业"},{"b_stop":"0","license_type":"0","bultem_code":"B01008","select_type":"1","bultem_name":"黑色金属矿采选业"},{"b_stop":"0","license_type":"0","bultem_code":"B01009","select_type":"1","bultem_name":"有色金属矿采选业"},{"b_stop":"0","license_type":"0","bultem_code":"B01010","select_type":"1","bultem_name":"非金属矿采选业"},{"b_stop":"0","license_type":"1","bultem_code":"B01011","select_type":"1","bultem_name":"开采辅助活动"},{"b_stop":"0","license_type":"1","bultem_code":"B01012","select_type":"1","bultem_name":"其他采矿业"}]},{"license_type":"0","bultem_code":"C01","select_type":"1","bultem_name":"制造业（含再制造）","children":[{"b_stop":"0","license_type":"1","bultem_code":"C01013","select_type":"1","bultem_name":"农副食品加工业"},{"b_stop":"0","license_type":"0","bultem_code":"C01014","select_type":"1","bultem_name":"食品制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01015","select_type":"1","bultem_name":"酒、饮料和精制茶制造业"},{"b_stop":"0","license_type":"2","bultem_code":"C01016","select_type":"1","bultem_name":"烟草制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01017","select_type":"1","bultem_name":"纺织业"},{"b_stop":"0","license_type":"0","bultem_code":"C01018","select_type":"1","bultem_name":"纺织服装、服饰业"},{"b_stop":"0","license_type":"0","bultem_code":"C01019","select_type":"1","bultem_name":"皮革、毛皮、羽毛及其制品和制鞋业"},{"b_stop":"0","license_type":"0","bultem_code":"C01020","select_type":"1","bultem_name":"木材加工和木、竹、藤、棕、草制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01021","select_type":"1","bultem_name":"家具制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01022","select_type":"1","bultem_name":"造纸和纸制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01023","select_type":"1","bultem_name":"印刷和记录媒介复制业"},{"b_stop":"0","license_type":"0","bultem_code":"C01024","select_type":"1","bultem_name":"文教、工美、体育和娱乐用品制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01025","select_type":"1","bultem_name":"石油加工、炼焦和核燃料加工业"},{"b_stop":"0","license_type":"0","bultem_code":"C01026","select_type":"1","bultem_name":"化学原料和化学制品制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01027","select_type":"1","bultem_name":"医药制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01028","select_type":"1","bultem_name":"化学纤维制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01029","select_type":"1","bultem_name":"橡胶和塑料制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01030","select_type":"1","bultem_name":"非金属矿物制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01031","select_type":"1","bultem_name":"黑色金属冶炼和压延加工业"},{"b_stop":"0","license_type":"0","bultem_code":"C01032","select_type":"1","bultem_name":"有色金属冶炼和压延加工业"},{"b_stop":"0","license_type":"0","bultem_code":"C01033","select_type":"1","bultem_name":"金属制品业"},{"b_stop":"0","license_type":"0","bultem_code":"C01034","select_type":"1","bultem_name":"通用设备制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01035","select_type":"1","bultem_name":"专用设备制造业"},{"b_stop":"0","license_type":"1","bultem_code":"C01036","select_type":"1","bultem_name":"汽车制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01037","select_type":"1","bultem_name":"铁路、船舶、航空航天和其他运输设备制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01038","select_type":"1","bultem_name":"电气机械和器材制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01039","select_type":"1","bultem_name":"计算机、通信和其他电子设备制造业"},{"b_stop":"0","license_type":"1","bultem_code":"C01040","select_type":"1","bultem_name":"仪器仪表制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01041","select_type":"1","bultem_name":"其他制造业"},{"b_stop":"0","license_type":"0","bultem_code":"C01042","select_type":"1","bultem_name":"废弃资源综合利用业"},{"b_stop":"0","license_type":"0","bultem_code":"C01043","select_type":"1","bultem_name":"金属制品、机械和设备修理业"}]},{"license_type":"0","bultem_code":"D01","select_type":"1","bultem_name":"电力、热力、燃气及水生产和供应业","children":[{"b_stop":"0","license_type":"0","bultem_code":"D01044","select_type":"1","bultem_name":"电力、热力生产和供应业"},{"b_stop":"0","license_type":"0","bultem_code":"D01045","select_type":"1","bultem_name":"燃气生产和供应业"},{"b_stop":"0","license_type":"0","bultem_code":"D01046","select_type":"1","bultem_name":"水的生产和供应业"}]},{"license_type":"0","bultem_code":"E01","select_type":"1","bultem_name":"建筑业","children":[{"b_stop":"0","license_type":"0","bultem_code":"E01047","select_type":"1","bultem_name":"房屋建筑业"},{"b_stop":"0","license_type":"0","bultem_code":"E01048","select_type":"1","bultem_name":"土木工程建筑业"},{"b_stop":"0","license_type":"0","bultem_code":"E01049","select_type":"1","bultem_name":"建筑安装业"},{"b_stop":"0","license_type":"0","bultem_code":"E01050","select_type":"1","bultem_name":"建筑装饰和其他建筑业"}]},{"license_type":"0","bultem_code":"F01","select_type":"1","bultem_name":"批发和零售业","children":[{"b_stop":"0","license_type":"0","bultem_code":"F01051","select_type":"1","bultem_name":"批发业"},{"b_stop":"0","license_type":"0","bultem_code":"F01052","select_type":"1","bultem_name":"零售业"}]},{"license_type":"0","bultem_code":"G01","select_type":"1","bultem_name":"交通运输、仓储和邮政、快递业","children":[{"b_stop":"0","license_type":"0","bultem_code":"G01053","select_type":"1","bultem_name":"铁路运输业"},{"b_stop":"0","license_type":"0","bultem_code":"G01054","select_type":"1","bultem_name":"道路运输业"},{"b_stop":"0","license_type":"0","bultem_code":"G01055","select_type":"1","bultem_name":"水上运输业"},{"b_stop":"0","license_type":"0","bultem_code":"G01056","select_type":"1","bultem_name":"航空运输业"},{"b_stop":"0","license_type":"0","bultem_code":"G01057","select_type":"1","bultem_name":"管道运输业"},{"b_stop":"0","license_type":"0","bultem_code":"G01058","select_type":"1","bultem_name":"装卸搬运和运输代理业"},{"b_stop":"0","license_type":"0","bultem_code":"G01059","select_type":"1","bultem_name":"仓储业"},{"b_stop":"0","license_type":"0","bultem_code":"G01060","select_type":"1","bultem_name":"邮政、快递业"}]},{"license_type":"0","bultem_code":"H01","select_type":"1","bultem_name":"住宿和餐饮业","children":[{"b_stop":"0","license_type":"0","bultem_code":"H01061","select_type":"1","bultem_name":"住宿业"},{"b_stop":"0","license_type":"0","bultem_code":"H01062","select_type":"1","bultem_name":"餐饮业"}]},{"license_type":"0","bultem_code":"I01","select_type":"1","bultem_name":"信息传输、软件和信息技术服务业","children":[{"b_stop":"0","license_type":"1","bultem_code":"I01063","select_type":"1","bultem_name":"电信、广播电视和卫星传输服务"},{"b_stop":"0","license_type":"1","bultem_code":"I01064","select_type":"1","bultem_name":"互联网和相关服务"},{"b_stop":"0","license_type":"0","bultem_code":"I01065","select_type":"1","bultem_name":"软件和信息技术服务业"}]},{"license_type":"0","bultem_code":"J01","select_type":"1","bultem_name":"金融业","children":[{"b_stop":"0","license_type":"0","bultem_code":"J01066","select_type":"1","bultem_name":"货币金融服务"},{"b_stop":"0","license_type":"0","bultem_code":"J01067","select_type":"1","bultem_name":"资本市场服务"},{"b_stop":"0","license_type":"0","bultem_code":"J01068","select_type":"1","bultem_name":"保险业"},{"b_stop":"0","license_type":"0","bultem_code":"J01069","select_type":"1","bultem_name":"其他金融业"},{"b_stop":"0","license_type":"0","bultem_code":"J0106A","select_type":"1","bultem_name":"经营保险代理业务"},{"b_stop":"0","license_type":"0","bultem_code":"J0106B","select_type":"1","bultem_name":"经营保险公估业务"},{"b_stop":"0","license_type":"0","bultem_code":"J0106C","select_type":"1","bultem_name":"经营保险经纪业务"}]},{"license_type":"0","bultem_code":"K01","select_type":"1","bultem_name":"房地产业","children":[{"b_stop":"0","license_type":"0","bultem_code":"K01070","select_type":"1","bultem_name":"房地产业"},{"b_stop":"0","license_type":"0","bultem_code":"K0107A","select_type":"1","bultem_name":"物业管理"},{"b_stop":"0","license_type":"0","bultem_code":"K0107B","select_type":"1","bultem_name":"房地产中介服务"}]},{"license_type":"0","bultem_code":"L01","select_type":"1","bultem_name":"租赁和商务服务业","children":[{"b_stop":"0","license_type":"0","bultem_code":"L01071","select_type":"1","bultem_name":"租赁业"},{"b_stop":"0","license_type":"0","bultem_code":"L01072","select_type":"1","bultem_name":"商务服务业"}]},{"license_type":"0","bultem_code":"M01","select_type":"1","bultem_name":"科学研究和技术服务业","children":[{"b_stop":"0","license_type":"0","bultem_code":"M01073","select_type":"1","bultem_name":"研究和试验发展"},{"b_stop":"0","license_type":"0","bultem_code":"M01074","select_type":"1","bultem_name":"专业技术服务业"},{"b_stop":"0","license_type":"0","bultem_code":"M01075","select_type":"1","bultem_name":"科技推广和应用服务业"}]},{"license_type":"0","bultem_code":"N01","select_type":"1","bultem_name":"水利、环境和公共设施管理业","children":[{"b_stop":"0","license_type":"0","bultem_code":"N01076","select_type":"1","bultem_name":"水利管理业"},{"b_stop":"0","license_type":"0","bultem_code":"N01077","select_type":"1","bultem_name":"生态保护和环境治理业"},{"b_stop":"0","license_type":"0","bultem_code":"N01078","select_type":"1","bultem_name":"公共设施管理业"}]},{"license_type":"0","bultem_code":"O01","select_type":"1","bultem_name":"居民服务、修理和其他服务业","children":[{"b_stop":"0","license_type":"0","bultem_code":"O01079","select_type":"1","bultem_name":"居民服务业"},{"b_stop":"0","license_type":"0","bultem_code":"O01080","select_type":"1","bultem_name":"机动车、电子产品和日用产品修理业"},{"b_stop":"0","license_type":"0","bultem_code":"O01081","select_type":"1","bultem_name":"其他服务业"}]},{"license_type":"0","bultem_code":"P01","select_type":"0","bultem_name":"教育","children":[{"b_stop":"0","license_type":"0","bultem_code":"P01082","select_type":"1","bultem_name":"教育"}]},{"license_type":"0","bultem_code":"Q01","select_type":"1","bultem_name":"卫生和社会工作","children":[{"b_stop":"0","license_type":"0","bultem_code":"Q01083","select_type":"1","bultem_name":"卫生"},{"b_stop":"0","license_type":"0","bultem_code":"Q01084","select_type":"1","bultem_name":"社会工作"}]},{"license_type":"0","bultem_code":"R01","select_type":"1","bultem_name":"文化、体育和娱乐业","children":[{"b_stop":"0","license_type":"0","bultem_code":"R01085","select_type":"1","bultem_name":"新闻和出版业"},{"b_stop":"0","license_type":"0","bultem_code":"R01086","select_type":"1","bultem_name":"广播、电视、电影和影视录音制作业"},{"b_stop":"0","license_type":"0","bultem_code":"R01087","select_type":"1","bultem_name":"文化艺术业"},{"b_stop":"0","license_type":"0","bultem_code":"R01088","select_type":"1","bultem_name":"体育"},{"b_stop":"0","license_type":"0","bultem_code":"R01089","select_type":"1","bultem_name":"娱乐业"}]}]
    let data = []
    getL1()
    function getL1 () {
      let json = {
        bultem_code: 'L1', // 行业代码
        type: '001', // 001:内资，002:外资,默认内资
        acceptregorg: '', // 行政区划代码
        licenseType: 1, // 1有前置 0无前置
        bclusters: 1, // 是否集群可用
      }
      // 把json转成get的query参数
      const queryStr = Object.keys(json).map(key => encodeURIComponent(key) +'=' + encodeURIComponent(json[key]) ).join('&')
      console.log(queryStr)
      let url = 'https://gztest.g4b.cn/ecGovBiz-platform/PubBusiScopeController/gzgsBusiScope?' + queryStr
      $.get(url, function(res, status){
        // console.log(res, status)
        if(status === 'success'){
          data = [...res.outData]
          console.log('获取第一级成功后', JSON.stringify(data))
          getL2(data)
        }
      })
    }

    function getL2 (data){
      // 获取经营范围二级
      $.each(data, function(index, item){
        let json = {
          bultem_code: item.bultem_code, // 行业代码
          type: '001', // 001:内资，002:外资,默认内资
          acceptregorg: '', // 行政区划代码
          licenseType: 1, // 1有前置 0无前置
          bclusters: 1, // 是否集群可用
        }
        // 把json转成get的query参数
        const queryStr = Object.keys(json).map(key => encodeURIComponent(key) +'=' + encodeURIComponent(json[key]) ).join('&')
        let url = 'https://gztest.g4b.cn/ecGovBiz-platform/PubBusiScopeController/gzgsBusiScope?' + queryStr
        $.get(url, function(res, status){
          if(status === 'success' && res.outData.length> 0){
            item.children = res.outData
            if(index === data.length - 1){
              console.log('获取第二级成功后', JSON.stringify(data))
            }
          }
        })
      })
      
    }
  </script>
</body>
</html>