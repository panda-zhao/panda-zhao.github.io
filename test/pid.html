<!--
 * @Author: your name
 * @Date: 2022-04-05 23:16:50
 * @LastEditTime: 2022-06-01 22:52:09
 * @LastEditors: zhaowy 82626363@qq.com
 * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
 * @FilePath: \panda-zhao.github.io\test\pid.html
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pid解析</title>
  </head>

  <body>
    <div id="main"></div>
    <script>
      // 获取PID
      // let queue = []
      // for (let index = 0; index < 96; index++) {
      //   let id = index + 1
      //   let result = index.toString(16).toUpperCase()
      //   result = result.length < 2 ? '010' + result : '01' + result
      //   // console.log(`10进制${index}，16进制=${result}, pid为:pid_${result}`)
      //   document.getElementById('main').innerHTML += `pid_${result}<br>`
      //   queue.push(result)
      // }

      // // zget_Version('Shenzhen Yuming Electronics Co., Ltd.version:V1.0.8>')
      // function zget_Version(msg) {
      //   if (msg.includes('NO DATA')) return ''
      //   msg = msg.replace(/[ ]|[\r]|[\n]|[\r\n]|[>]/g, '')
      //   try {
      //     var result = msg.substring(msg.indexOf('version:') + 8) // 有效数据
      //     // console.log('版本号', result)
      //     return result
      //   } catch (error) {
      //     console.error(error)
      //     return ''
      //   }
      // }

      // get_support('7E8 06 4100 FF FE D3 84 01>', '0100')
      // get_support('7E8064100FFFFFFFF>', '0100')

      let result0100 = `
      7E8 06 41 00 98 18 00 01 \r
      7E9 06 41 00 BE 3E A8 13 \r
      7EA 06 41 00 98 18 00 01 \r
      7EB 06 41 00 BE 3E A8 13 \r
      7EC 06 41 00 98 18 00 01 \r
      7ED 06 41 00 BE 3E A8 13 \r
      7EE 06 41 00 98 18 00 01 \r
      7EF 06 41 00 BE 3E A8 13 > `
      // get_support(result0100, '0100')
      function get_support(msg, code) {
        if (msg === 'NO DATA') return null
        try {
          let separator = code.replace('0', '4') // 分隔符
          msg = msg.replace(/[ ]|[>]/g, '')
          let result = '00000000000000000000000000000000'.split('')
          let msgArray = msg.split('\r')
          console.log('1=', msgArray)
          for (let i = 0; i < msgArray.length; i++) {
            const item = msgArray[i]
            if (item.includes(separator)) {
              let start = item.indexOf(separator) + 4
              let data = item.substring(start, start + 8)
              console.log(2, '每条里面的有效数据', data)
              // 16进制转10进制再转2进制
              var a = parseInt(data.substring(0, 2), 16).toString(2)
              while (a.length < 8) {
                a = 0 + a
              }
              var b = parseInt(data.substring(2, 4), 16).toString(2)
              while (b.length < 8) {
                b = 0 + b
              }
              var c = parseInt(data.substring(4, 6), 16).toString(2)
              while (c.length < 8) {
                c = 0 + c
              }
              var d = parseInt(data.substring(6, 8), 16).toString(2)
              while (d.length < 8) {
                d = 0 + d
              }
              let _result = a + b + c + d
              console.log(3, '当前数据支持情况', _result)
              for (let index = 0; index < result.length; index++) {
                if (result[index] === '0' && _result[index] === '1') {
                  result[index] = '1'
                }
              }
            }
          }
          console.log(4, '当前数据支持情况', result, result.join(''))
          return result.join()
        } catch (error) {
          alert('error：0100\r\n' + error)
          return null
        }
      }

      // 0902
      // const value =
      //   '7E810144902014C4443\r7E82131323334353637\r7E82238393031323334 >'
      // 0904
      // const value2 =
      //   '7E81014490400534E30 \r7E82131323334353637 \r7E82238393031323334 >'
      // 0906
      // const value3 =
      //   '7E81014490600534E30 \r7E82131323334353637 \r7E82238393031323334 >'

      // get_0902(value)
      // function get_0902(msg) {
      //   //        7E8 10 14 49 02 01 31 41 31
      //   //        7E8 21 4A 43 35 34 34 34 52
      //   //        7E8 22 37 32 35 32 33 36 37
      //   //测试箱不一样
      //   //        7E8 07 49 02 01 00 00 00 33
      //   //        7E8 07 49 02 02 47 31 4A 43
      //   //        7E8 07 49 02 03 35 34 34 34
      //   //        7E8 07 49 02 04 52 37 32 35
      //   //        7E8 07 49 02 05 32 33 36 37
      //   //        7E8 07 49 02 06 01 4A 4D 42

      //   //        18 DA F1 11 10 14 49 02 01 31 41 31
      //   //        18 DA F1 11 21 4A 43 35 34 34 34 52
      //   //        18 DA F1 11 22 37 32 35 32 33 36 37

      //   //        87 F1 11 49 02 01 00 00 00 31 06
      //   //        87 F1 11 49 02 02 41 31 4A 43 D5
      //   //        87 F1 11 49 02 03 35 34 34 34 A8
      //   //        87 F1 11 49 02 04 52 37 32 35 C8
      //   //        87 F1 11 49 02 05 32 33 36 37 AB

      //   var index = msg.indexOf('>')
      //   if (index != -1) {
      //     msg = msg.slice(0, index).trim()
      //   }
      //   console.log('1', msg)
      //   var result = ''
      //   var msgArray = msg.split('\r')
      //   console.log('2', msgArray)
      //   for (var i = 0; i < msgArray.length; i++) {
      //     var s = msgArray[i]
      //     if (s.length == 19) {
      //       result += s.includes('4902')
      //         ? s.substring(s.indexOf('4902') + 6)
      //         : s.substring(5)
      //     }
      //     if (s.length == 24) {
      //       result += s.includes('490201') ? s.substring(18) : s.substring(10)
      //     }
      //     if (s.length == 22) {
      //       result += s.substring(12, 20)
      //     }
      //   }
      //   console.log('3', result)
      //   result = result.replace(/00/g, '')
      //   console.log('4', result)
      //   if (result.length < 34) return 'NODATA'

      //   var res = new Array(17)
      //   for (var i = 0; i < 17; i++) {
      //     var start = i * 2
      //     res[i] = parseInt(result.substring(start, start + 2), 16)
      //   }
      //   console.log('5', res)
      //   var vin = ''
      //   for (var i = 0; i < res.length; i++) {
      //     vin += String.fromCharCode(res[i])
      //   }
      //   console.log('6vin=', vin)
      //   return vin
      // }

     

    </script>
  </body>
</html>
