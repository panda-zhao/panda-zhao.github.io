<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>大众故障码解析</title>
</head>
<body>
  <div id="container"></div>
  <!-- <script src="./en_dtc.js"></script> -->
  <script src="./cn_dtc.txt"></script>
  <script>
    
    // console.log(data)
    let _length = 0
    
    
    // format3340C1DA('0x3340C1DA E354')
    // format3340C1DA('0x3340C1DAE355')
    
    // format3340C1DA('0x3340C1DA A3BC')

    /**
     * 格式化首字母为PBCU, 标准码为5位
     * 原始码为4位或者6位16进制字符
     * */
    function format_first(code){
      let result = null
      if(code.length < 4){
        console.error('错误的代码')
        return result
      }
      const hexDigitReplace = {'0':'P0','1':'P1','2':'P2','3':'P3','4':'C0','5':'C1','6':'C2','7':'C3','8':'B0','9':'B1',"A":'B2',"B":'B3',"C":'U0',"D":'U1',"E":'U2',"F":'U3'}
      result = hexDigitReplace[code.charAt(0)] + code.substring(1)
      if (result.substring(5) === '00') {
        result = result.substring(0, 5)
      }
      return result
    }

    // P0232
    function format3340C1DA (str) {
      let code = str.substring(str.length-4)
      let _code_16 = '0x' + code
      let _result =  _code_16 ^ '0xE354'// 异或操作,结果是 十进制
      let result =_result.toString(16).toUpperCase()
      while (result.length < 4){
        result = '0' + result
      }
      console.log(`${str} => ${code} => ${result}` )
      document.getElementById('container').innerHTML += `${str} => ${result} <br>`
      return result
    }

    let arr = []
    for (const key in data) {
      _length++
      const element = data[key];
      if(key.includes('0x3340C1DA')){
        let chunk = format3340C1DA(key)
        if(!arr.includes(chunk.substring(0, 1))){
          arr.push(chunk.substring(0, 1))
        }
      }
      // document.getElementById('container').innerHTML += `${key}: ${element} <br>`
    }

    document.getElementById('container').innerHTML += JSON.stringify(arr)
    // let length = 0
    // data.forEach(item => {
    //   if (!item.code || !item.describe || !item.lang) {
    //     length++
    //     console.log(JSON.stringify(item))
    //   }
    // })
    // console.log("错误的数量=", length)
  </script>
</body>
</html>